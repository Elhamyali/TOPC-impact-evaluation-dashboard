---
title: "TOPC Cohort 3 Analysis"
subtitle: "Pre-test"
author: "Elham Ali"
date: Dec 20, 2023
format:
  html:
    toc: true
    code-fold: true
    code-summary: "Show the code"
editor: visual
cache: true
---

Graphs for pre-test survey analysis for city governments.

## Install necessary packages

```{r}
#| label: packages-installation
#| message: false

# Set a CRAN mirror
options(repos = c(CRAN = "https://cloud.r-project.org"))

# Install necessary packages
# install.packages("magrittr")
# install.packages("dplyr")
# install.packages("ggplot2")
# install.packages("knitr")
# install.packages("KableExtra")
# install.packages("survey")

# Load the packages
library(magrittr)
library(dplyr)
library(ggplot2)
library(knitr)
library(survey)
```

## Calculate design weights

```{r}
#| label: design-weights
#| message: false

# Read the data from the CSV file
cohort3BackgroundGov <- read.csv("~/Documents/R Projects/TOPC-impact-evaluation-dashboard/Cohort 3/cohort3BackgroundGov2.csv")

# Define population and sample sizes
population_counts <- c(Akron = 8, Detroit = 9, Macon = 10, Miami = 13)
sample_counts <- c(Akron = 4, Detroit = 2, Macon = 4, Miami = 3)

# Total population and sample size
total_population <- sum(population_counts)
total_sample <- sum(sample_counts)

# Calculate the weights
weights <- (population_counts / total_population) / (sample_counts / total_sample)

# Print the calculated weights
print(weights)
```

## Define the survey design

```{r}
#| label: survey-design-definition
#| message: false
# Map between city names 
city_map <- list(
  "Miami-Dade County, FL" = "Miami",
  "Akron, OH" = "Akron",
  "City of Akron" = "Akron",
  "Detroit, MI" = "Detroit",
  "Macon-Bibb, GA" = "Macon"
)

# Update dataframe to use the mapped names
cohort3BackgroundGov$city_mapped <- unlist(lapply(cohort3BackgroundGov$q4, function(x) city_map[[x]]))

# Assign weights using the mapped city names
cohort3BackgroundGov$weights <- weights[cohort3BackgroundGov$city_mapped]

# Define the survey design
design <- svydesign(ids = ~1, 
                    strata = ~city_mapped, 
                    weights = ~weights, 
                    data = cohort3BackgroundGov)
```

```{r}
#| label: all-questions
#| message: false

library(dplyr)


# # Assuming your dataframe is 'cohort3BackgroundGov' and all your question columns start with 'q'
# question_cols <- names(cohort3BackgroundGov)[grepl("^q", names(cohort3BackgroundGov))]
# 
# # Function to calculate descriptive statistics
# calculate_stats <- function(column) {
#   data <- cohort3BackgroundGov[[column]]
#   list(
#     Mean = mean(data, na.rm = TRUE),
#     Median = median(data, na.rm = TRUE),
#     Mode = as.numeric(names(sort(table(data), decreasing = TRUE)[1])),
#     Q1 = quantile(data, 0.25, na.rm = TRUE),
#     Q3 = quantile(data, 0.75, na.rm = TRUE),
#     SD = sd(data, na.rm = TRUE)
#   )
# }
# 
# # Apply the function to each question column
# stats <- map(question_cols, calculate_stats)
# 
# # Convert the results to a dataframe for easy viewing
# stats_df <- bind_rows(stats, .id = "Question")

```

## Participant Background

Q4. Which gender do you most closely identify with (or self-describe in 'other')?

## Goal 1: Participant Awareness and Knowledge

**Community Research**

**Q3.**

## Goal 2: Participant Confidence and Competence

None

## Goal 3: Participant Recognition and Application of Methods

None

## Goal 4: Participant Satisfaction and Intention to Action

None

## Limitations

The pre-test and post-test survey questions are conceptually aligned but not directly comparable in terms of measurement scales and language of questions. The pre-test uses a 4-point Likert scale focused on agreement, while the post-test uses a 5-point scale assessing expertise levels. This difference in scales means a direct comparison or change analysis (like a t-test) is not straightforward.

However, both sets of questions target similar skills and experiences. To assess changes, I looked at shifts in distribution of responses, using non-parametric methods or descriptive statistics to compare "before" and "after" without inferring statistical significance based on the Likert scale points. Qualitative analysis of open-ended responses also provided some insights into changes in participants' experiences and perceptions.
